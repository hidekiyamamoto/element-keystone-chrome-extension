/*!
 ______  _____ _______ _______  _____   ______ _______
 |     \   |   |______    |    |     | |_____/    |   
 |_____/ __|__ ______|    |    |_____| |    \_    |   
                                                      
 distort 1.0.2-alpha <http://isuttell.github.io/distort/>
 Contributor(s): Isaac Suttell <isaac@isaacsuttell.com>
 Last Build: 2014-11-29
*/
!function(a,b){"use strict";"function"==typeof define&&"object"==typeof define.amd?define([],function(){return b(a)}):a.Distort=b(a)}(this,function(){"use strict";function a(a,b){this.x=a||0,this.y=b||0}function b(b,c,d){b=b||{},b.x=b.x?b.x.toString():"",b.y=b.y?b.y.toString():"";var e=l(b.x,c),f=l(b.y,d);return new a(e,f)}function Distort(c){c=c||{},this.width=c.width,this.height=c.height,c.$el&&c.$el instanceof window.$&&(this.$el=c.$el,this.width=this.$el.width(),this.height=this.$el.height()),this.offset=new b(c.offset,this.width,this.height),this.matrix=k,this.topLeft=new a(0,0),this.topRight=new a(this.width,0),this.bottomLeft=new a(0,this.height),this.bottomRight=new a(this.width,this.height),this.dpr=window.devicePixelRatio||1,this.update()}function c(a,b,c){for(var d=0,e=-1;++e<c;)d+=a[e]*b[e];return d}function d(a,b){for(var c=-1;++c<8;)a[c]=b[a[c]];return c=void 0,a}function e(a,b){for(var c,d=-1;++d<8;)for(c=d;++c<8;)a[c]-=a[d]*b[c][d];return c=void 0,d=void 0,a}function f(a,b){for(var c,d=8;--d>-1;)for(a[d]/=b[d][d],c=-1;++c<d;)a[c]-=a[d]*b[c][d];return c=void 0,d=void 0,a}function g(a){for(var b=-1;++b<16;)a[b]=parseFloat(a[b]);return a}function h(a){var b;return b="matrix3d(",b+=a.join(", "),b+=")"}function i(a,b,c){return a.x*b.y+b.x*c.y+c.x*a.y-a.y*b.x-b.y*c.x-c.y*a.x}function j(a,b){var c=["$el","offset"];for(var d in b)a[d]=m(b[d])&&-1===c.indexOf(d)?j({},b[d]):b[d];return a}var k=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];a.prototype.distanceTo=function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)};var l=function(a,b){return a.indexOf("%")>-1?-parseFloat(a)*b/100:a.indexOf("px")>-1?-parseFloat(a):b*-.5};Distort.prototype.VERSION="v1.0.2-alpha",Distort.prototype.setupMatrixes=function(){for(var a=[[0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0]],b=[0,0,0,0,0,0,0,0],c=[this.topLeft,this.topRight,this.bottomLeft,this.bottomRight],d=-1;++d<4;)a[d][0]=a[d+4][3]=1&d?this.width+this.offset.x:this.offset.x,a[d][1]=a[d+4][4]=d>1?this.height+this.offset.y:this.offset.y,a[d][6]=(1&d?-this.offset.x-this.width:-this.offset.x)*(c[d].x+this.offset.x),a[d][7]=(d>1?-this.offset.y-this.height:-this.offset.y)*(c[d].x+this.offset.x),a[d+4][6]=(1&d?-this.offset.x-this.width:-this.offset.x)*(c[d].y+this.offset.y),a[d+4][7]=(d>1?-this.offset.y-this.height:-this.offset.y)*(c[d].y+this.offset.y),b[d]=c[d].x+this.offset.x,b[d+4]=c[d].y+this.offset.y,a[d][2]=a[d+4][5]=1,a[d][3]=a[d][4]=a[d][5]=a[d+4][0]=a[d+4][1]=a[d+4][2]=0;return c=void 0,d=void 0,{aM:a,bM:b}},Distort.prototype.calculate=function(){this.isValid=!1;var a,b,h,i,j,k=[],l=[],m=this.setupMatrixes(),n=m.aM,o=m.bM;m=void 0;var p=[0,1,2,3,4,5,6,7];for(h=0;8>h;h++){for(b=0;8>b;b++)l[b]=n[b][h];for(b=0;8>b;b++)k=n[b],a=c(k,l,Math.min(b,h)),k[h]=l[b]-=a;for(j=h,b=h+1;8>b;b++)Math.abs(l[b])>Math.abs(l[j])&&(j=b);if(j!==h){var q;for(i=0;8>i;i++)q=n[j][i],n[j][i]=n[h][i],n[h][i]=q;q=p[j],p[j]=p[h],p[h]=q}if(0!==n[h][h])for(b=h+1;8>b;b++)n[b][h]/=n[h][h]}return p=d(p,o),p=e(p,n),p=f(p,n),this.matrix[0]=p[0].toFixed(9),this.matrix[1]=p[3].toFixed(9),this.matrix[2]=0,this.matrix[3]=p[6].toFixed(9),this.matrix[4]=p[1].toFixed(9),this.matrix[5]=p[4].toFixed(9),this.matrix[6]=0,this.matrix[7]=p[7].toFixed(9),this.matrix[8]=0,this.matrix[9]=0,this.matrix[10]=1,this.matrix[11]=0,this.matrix[12]=p[2].toFixed(9),this.matrix[13]=p[5].toFixed(9),this.matrix[14]=0,this.matrix[15]=1,this.matrix=g.call(this,this.matrix),a=void 0,k=void 0,l=void 0,b=void 0,h=void 0,i=void 0,j=void 0,p=void 0,n=void 0,o=void 0,this.matrix},Distort.prototype.hasDistancesError=function(){return this.topLeft.distanceTo(this.topRight)<=1?!0:this.bottomLeft.distanceTo(this.bottomRight)<=1?!0:this.topLeft.distanceTo(this.bottomLeft)<=1?!0:this.topRight.distanceTo(this.bottomRight)<=1?!0:this.topLeft.distanceTo(this.bottomRight)<=1?!0:this.topRight.distanceTo(this.bottomLeft)<=1?!0:!1},Distort.prototype.hasPolygonError=function(){var a,b;return a=i(this.topLeft,this.topRight,this.bottomRight),b=i(this.bottomRight,this.bottomLeft,this.topLeft),0>=a||0>=b?!0:(a=i(this.topRight,this.bottomRight,this.bottomLeft),b=i(this.bottomLeft,this.topLeft,this.topRight),0>=a||0>=b?!0:!1)},Distort.prototype.hasErrors=function(){return this.hasDistancesError()?1:this.hasPolygonError()?2:0},Distort.prototype.update=function(){return this.calculate(),this.hasErrors()?(this.isValid=!1,this.style=h.call(this,k),this.style):(this.isValid=!0,this.style=h.call(this,this.matrix),this.dprFix&&(this.style+=" scale("+this.dpr+", "+this.dpr+") ",this.style+="perspective(1000px) ",this.style+="translateZ("+1e3*(1-this.dpr)+"px)"),this.style)},Distort.prototype.toString=Distort.prototype.update,Distort.prototype.equals=function(a){return this.toString()===a.toString()};var m=function(a){var b={}.toString.call(a);return"[object Object]"===b};return Distort.prototype.clone=function(){return j(new Distort,this)},Distort.prototype.translate=function(a,b){return this.topLeft.x+=a,this.topRight.x+=a,this.bottomLeft.x+=a,this.bottomRight.x+=a,this.topLeft.y+=b,this.topRight.y+=b,this.bottomLeft.y+=b,this.bottomRight.y+=b,this},Distort.prototype.translateX=function(a){return this.translate(a,0),this},Distort.prototype.translateY=function(a){return this.translate(0,a),this},Distort.prototype.scale=function(a){return this.translate(-this.width/2,-this.height/2),this.topLeft.x*=a,this.topRight.x*=a,this.bottomLeft.x*=a,this.bottomRight.x*=a,this.topLeft.y*=a,this.topRight.y*=a,this.bottomLeft.y*=a,this.bottomRight.y*=a,this.translate(this.width/2,this.height/2),this},Distort.prototype.forcePerspective=function(a,b){if("top"===a)this.topLeft.x-=b,this.topRight.x+=b;else if("left"===a)this.topLeft.y-=b,this.bottomLeft.y+=b;else if("bottom"===a)this.bottomLeft.x-=b,this.bottomRight.x+=b;else{if("right"!==a)throw new Error("Invalid Perspective Direction");this.topRight.y-=b,this.bottomRight.y+=b}return this},Distort});